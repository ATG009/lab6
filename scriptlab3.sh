#!/bin/bash

# Проверяем, передан ли аргумент с номером терминала
if [ $# -ne 1 ]; then
echo "Пожалуйста, укажите номер терминала в качестве аргумента."
exit 1
fi

# Номер терминала для перенаправления вывода
terminal_number=$1

# Создаем семафор с именем "my_semaphore"
semaphore="my_semaphore"

# Попытка получить доступ к семафору
if ! ln -s $$ $semaphore 2>/dev/null; then
echo "Ожидание освобождения ресурса..."
while ! ln -s $$ $semaphore 2>/dev/null; do
sleep 1
done
echo "Ресурс освободился. Начинаем использовать его."
fi

# Выполняем какую-то работу 
echo "Процесс $$ начал использовать ресурс."

# Задержка для имитации использования ресурса
sleep 5

# Освобождаем семафор
rm $semaphore

# Завершаем процесс
echo "Процесс $$ завершил работу."

# Перенаправляем вывод в другой терминал
echo "Процесс $$ завершил работу." > /dev/tty$terminal_number
